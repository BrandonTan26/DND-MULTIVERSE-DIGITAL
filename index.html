<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>D&D Multiverse Digital — Katalog Layanan Digital</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f1f5f9;
      --surface:#ffffff;
      --surface-soft:#f8fafc;
      --text:#020617;
      --muted:#64748b;
      --border:#e2e8f0;
      --primary:#1d4ed8;
      --primary-soft:#2563eb;
      --accent:#22c55e;
      --shadow:0 10px 30px rgba(15,23,42,.08);
      --radius:18px;
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:'Manrope', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
    }

    a{text-decoration:none;color:inherit;}

    /* TOP BAR */
    .topbar{
      position:sticky;
      top:0;
      z-index:20;
      backdrop-filter:blur(14px);
      background:rgba(255,255,255,.92);
      border-bottom:1px solid var(--border);
    }
    .topbar-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      padding:.75rem 1rem;
      max-width:960px;
      margin:0 auto;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    .brand-logo{
      width:42px;
      height:42px;
      border-radius:14px;
      background:var(--surface-soft);
      border:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      color:var(--primary);
    }
    .brand-title{
      font-size:1rem;
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .brand-sub{
      font-size:.8rem;
      color:var(--muted);
      margin-top:.1rem;
    }
    .topbar-actions{
      display:flex;
      align-items:center;
      gap:.5rem;
    }
    .btn-pill{
      border-radius:999px;
      padding:.5rem .9rem;
      border:1px solid var(--border);
      background:#fff;
      font-size:.85rem;
      font-weight:700;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
    }
    .btn-pill-primary{
      border:none;
      background:var(--primary);
      color:#fff;
    }
    .btn-pill-primary:hover{background:var(--primary-soft);}

    /* HERO */
    .hero{
      padding:1.8rem 1.4rem 1.3rem;
      background:linear-gradient(135deg,#1d4ed8 0%,#7c3aed 40%,#22c55e 100%);
      color:#f9fafb;
      box-shadow:0 10px 30px rgba(15,23,42,.35);
    }
    .hero-inner{
      max-width:960px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:1rem;
    }
    .hero-badge{
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      padding:.3rem .75rem;
      border-radius:999px;
      background:rgba(15,23,42,.18);
      font-size:.8rem;
      font-weight:600;
    }
    .hero h1{
      margin:.5rem 0 .2rem;
      font-size:1.9rem;
      font-weight:900;
      letter-spacing:-.02em;
    }
    .hero p{
      margin:0;
      max-width:560px;
      font-size:.95rem;
    }
    .hero-meta{
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
      margin-top:.7rem;
      font-size:.82rem;
    }
    .hero-meta span{
      display:inline-flex;
      align-items:center;
      gap:.3rem;
      padding:.25rem .65rem;
      border-radius:999px;
      background:rgba(15,23,42,.2);
    }

    /* SECTION TITLE */
    .section{
      padding:1.6rem 1.2rem 2rem;
    }
    .section-inner{
      max-width:960px;
      margin:0 auto;
    }
    .section-title{
      text-align:center;
      font-size:1.4rem;
      font-weight:800;
      margin-bottom:.2rem;
    }
    .section-sub{
      text-align:center;
      font-size:.9rem;
      color:var(--muted);
      margin-bottom:1rem;
    }

    /* SEARCH BAR */
    .search-card{
      background:var(--surface);
      border-radius:var(--radius);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      padding:.9rem;
      margin-bottom:1rem;
    }
    .search-grid{
      display:flex;
      flex-direction:column;
      gap:.75rem;
    }
    @media (min-width:576px){
      .search-grid{
        flex-direction:row;
      }
      .search-grid > div{
        flex:1;
      }
    }
    .label{
      font-size:.8rem;
      font-weight:800;
      margin-bottom:.25rem;
      color:var(--muted);
    }
    .control{
      width:100%;
      border-radius:12px;
      border:1px solid var(--border);
      padding:.6rem .75rem;
      font-size:.9rem;
    }
    .control:focus{
      outline:none;
      border-color:rgba(37,99,235,.6);
      box-shadow:0 0 0 3px rgba(37,99,235,.15);
    }

    /* PRODUCT GRID */
    .grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:.9rem;
    }
    @media (min-width:768px){
      .grid{grid-template-columns:repeat(3,minmax(0,1fr));}
    }

    .cardx{
      background:var(--surface);
      border-radius:var(--radius);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      padding:.75rem .8rem .8rem;
      display:flex;
      flex-direction:column;
      gap:.45rem;
      height:100%;
    }
    .cardx-top{
      display:flex;
      gap:.6rem;
      align-items:flex-start;
    }
    .logo{
      width:42px;
      height:42px;
      border-radius:14px;
      background:var(--surface-soft);
      border:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      overflow:hidden;
    }
    .logo img{
      width:28px;
      height:28px;
      object-fit:contain;
    }
    .title{
      font-size:.95rem;
      font-weight:800;
      margin-bottom:.1rem;
    }
    .category{
      font-size:.78rem;
      color:var(--muted);
    }
    .desc{
      font-size:.8rem;
      color:var(--muted);
      min-height:2.2em;
    }
    .price-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:.4rem;
      margin-top:.2rem;
    }
    .price-main{
      font-size:1rem;
      font-weight:900;
      color:var(--primary);
    }
    .price-base{
      font-size:.78rem;
      color:var(--muted);
    }
    .btn-wa{
      margin-top:.45rem;
      width:100%;
      border:none;
      border-radius:12px;
      padding:.55rem .7rem;
      background:var(--accent);
      color:#052e16;
      font-size:.85rem;
      font-weight:800;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.4rem;
    }
    .btn-wa i{font-size:.95rem;}

    /* STATE BOXES */
    .state-box{
      background:var(--surface);
      border-radius:var(--radius);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      padding:1rem;
      text-align:center;
      color:var(--muted);
      font-size:.9rem;
    }
    .spinner{
      width:32px;
      height:32px;
      border-radius:50%;
      border:3px solid #e2e8f0;
      border-top-color:var(--primary);
      margin:0 auto .6rem;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg);}}

    .btn-load-more{
      margin-top:1rem;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      border-radius:999px;
      padding:.45rem 1.1rem;
      border:1px solid var(--primary);
      background:#fff;
      font-size:.85rem;
      font-weight:700;
      color:var(--primary);
    }

    /* FOOTER */
    .footer{
      border-top:1px solid var(--border);
      padding:1rem 1.2rem 1.4rem;
      font-size:.8rem;
      color:var(--muted);
    }
    .footer-inner{
      max-width:960px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      gap:.75rem;
      flex-wrap:wrap;
    }

    /* WELCOME POPUP */
    .welcome-popup{
      position:fixed;
      left:50%;
      bottom:16px;
      transform:translateX(-50%);
      max-width:360px;
      width:calc(100% - 32px);
      background:#020617;
      color:#e5e7eb;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 18px 40px rgba(15,23,42,.7);
      padding:.75rem .85rem;
      display:none;
      z-index:50;
      font-size:.8rem;
    }
    .welcome-popup.show{display:flex;}
    .welcome-icon{
      width:28px;
      height:28px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(56,189,248,.15);
      color:#7dd3fc;
      flex-shrink:0;
      margin-right:.55rem;
      margin-top:.08rem;
    }
    .welcome-title{
      font-weight:800;
      font-size:.9rem;
      margin-bottom:.1rem;
    }
    .welcome-text{
      color:#cbd5f5;
    }
    .welcome-actions{
      margin-top:.4rem;
      display:flex;
      justify-content:flex-end;
    }
    #welcomeGotIt{
      border:none;
      border-radius:999px;
      padding:.2rem .9rem;
      font-size:.78rem;
      font-weight:700;
      background:#e5e7eb;
      color:#020617;
    }

    @media (min-width:768px){
      .hero h1{font-size:2.1rem;}
    }
  </style>
</head>
<body>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-logo">
          <i class="fa-solid fa-bolt"></i>
        </div>
        <div>
          <div class="brand-title">D&D MULTIVERSE DIGITAL</div>
          <div class="brand-sub">Layanan Digital • Aplikasi Premium</div>
        </div>
      </div>
      <div class="topbar-actions">
        <button class="btn-pill" onclick="document.getElementById('produk').scrollIntoView({behavior:'smooth'})">
          <i class="fa-solid fa-list"></i> Produk
        </button>
        <a href="https://wa.me/6287809236556?text=Halo%20admin%2C%20saya%20ingin%20tanya%20harga%20paket%20digital."
           target="_blank" class="btn-pill btn-pill-primary">
          <i class="fa-brands fa-whatsapp"></i> Chat Admin
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-badge">
        <i class="fa-solid fa-circle-check"></i>
        <span>Portal resmi untuk langganan aplikasi premium.</span>
      </div>
      <div>
        <h1>Katalog Layanan Digital</h1>
        <p>
          Pilih paket langganan Netflix, YouTube Premium, Spotify, Canva Pro, CapCut, dan aplikasi lainnya
          yang paling relevan dengan kebutuhan kerja, hiburan, dan produktivitas Anda.
        </p>
      </div>
      <div class="hero-meta">
        <span><i class="fa-solid fa-bolt"></i> Estimasi proses 1–10 menit*</span>
        <span><i class="fa-solid fa-shield-halved"></i> Garansi masa pakai sesuai ketentuan</span>
      </div>
    </div>
  </section>

  <!-- PRODUK -->
  <section class="section" id="produk">
    <div class="section-inner">
      <h2 class="section-title">Daftar Produk Digital</h2>
      <p class="section-sub">
        Data diambil langsung dari Google Sheet. Harga yang ditampilkan sudah termasuk penyesuaian D&D Multiverse Digital.
      </p>

      <div class="search-card">
        <div class="search-grid">
          <div>
            <div class="label">Cari aplikasi / layanan</div>
            <input id="searchInput" type="text" class="control" placeholder="Contoh: Netflix, YouTube, Spotify, Canva, CapCut...">
          </div>
          <div>
            <div class="label">Filter kategori</div>
            <select id="filterKategori" class="control">
              <option value="">Semua Kategori</option>
              <option value="Langganan">Langganan</option>
              <option value="Streaming">Streaming</option>
              <option value="Penyimpanan">Penyimpanan</option>
              <option value="Software">Software</option>
              <option value="Desain">Desain</option>
              <option value="Produktivitas">Produktivitas</option>
              <option value="AI Tools">AI Tools</option>
              <option value="Keamanan">Keamanan</option>
              <option value="Game">Game</option>
              <option value="Voucher">Voucher</option>
            </select>
          </div>
        </div>
      </div>

      <div id="produk-list">
        <div class="state-box">
          <div class="spinner"></div>
          <div style="font-weight:800;color:#0f172a;">Memuat data produk...</div>
          <div style="font-size:.85rem;margin-top:.1rem;">Mohon tunggu sebentar.</div>
        </div>
      </div>

      <div style="text-align:center;margin-top:.75rem;">
        <button id="btnLoadMore" class="btn-load-more" style="display:none;">
          <i class="fa-solid fa-rotate-right"></i> Muat Lebih
        </button>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <span>© <span id="yearNow">2026</span> D&D Multiverse Digital.</span>
      <span>Operasional &amp; penyesuaian harga dikelola oleh admin D&D Multiverse Digital.</span>
    </div>
  </footer>

  <!-- WELCOME POPUP -->
  <div id="welcomePopup" class="welcome-popup">
    <div class="welcome-icon">
      <i class="fa-solid fa-hand"></i>
    </div>
    <div>
      <div class="welcome-title">Welcome to D&D Multiverse Digital</div>
      <div class="welcome-text">
        Netflix, YouTube Premium, Spotify, Canva Pro, CapCut, dan layanan digital lain bisa Anda pesan
        dari satu portal dengan alur yang jelas dan bantuan admin.
      </div>
      <div class="welcome-actions">
        <button id="welcomeGotIt">Got it</button>
      </div>
    </div>
  </div>

  <script>
    // ==== KONFIGURASI SHEET + KONSTAN ====
    var SHEET_ID   = "1gXUenYCrCgTwn__ujVIHw9pOODIV_f0JsdNMAFla9oQ";
    var SHEET_NAME = "Produk";
    var DEFAULT_WA = "6287809236556";
    var SHEET_JSON_URL =
      "https://docs.google.com/spreadsheets/d/" + SHEET_ID +
      "/gviz/tq?tqx=out:json&sheet=" + encodeURIComponent(SHEET_NAME);

    var allProducts = [];
    var page = 1;
    var perPage = 12;

    var produkList = document.getElementById("produk-list");
    var searchInput = document.getElementById("searchInput");
    var filterKategori = document.getElementById("filterKategori");
    var btnLoadMore = document.getElementById("btnLoadMore");

    function formatRp(num){
      return "Rp" + (Number(num) || 0).toLocaleString("id-ID");
    }

    function showLoading(){
      produkList.innerHTML =
        '<div class="state-box">' +
          '<div class="spinner"></div>' +
          '<div style="font-weight:800;color:#0f172a;">Memuat data produk...</div>' +
          '<div style="font-size:.85rem;margin-top:.1rem;">Mohon tunggu sebentar.</div>' +
        '</div>';
    }

    function showError(msg){
      produkList.innerHTML =
        '<div class="state-box">' +
          '<div style="font-size:1.1rem;margin-bottom:.3rem;color:#b91c1c;font-weight:800;">' +
            '<i class="fa-solid fa-triangle-exclamation me-1"></i>Gagal memuat data' +
          '</div>' +
          '<div style="margin-bottom:.4rem;">Periksa pengaturan berbagi Google Sheet, ID, dan nama sheet.</div>' +
          '<code style="font-size:.75rem;word-break:break-all;display:block;background:#f1f5f9;padding:.3rem .4rem;border-radius:8px;">' +
            SHEET_JSON_URL +
          '</code>' +
          (msg ? '<div style="margin-top:.4rem;font-size:.8rem;color:#9ca3af;">' + String(msg) + '</div>' : '') +
        '</div>';
    }

    function showEmpty(){
      produkList.innerHTML =
        '<div class="state-box">' +
          '<div style="font-size:1.1rem;margin-bottom:.2rem;font-weight:800;color:#0f172a;">' +
            '<i class="fa-solid fa-magnifying-glass me-1"></i>Produk tidak ditemukan' +
          '</div>' +
          '<div>Coba ubah kata kunci atau filter kategori.</div>' +
        '</div>';
    }

    function escapeHtml(str){
      return String(str || "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function makeWAUrl(msg, wa){
      return "https://wa.me/" + encodeURIComponent(wa) +
             "?text=" + encodeURIComponent(msg);
    }

    function filterData(){
      var q = (searchInput.value || "").toLowerCase();
      var cat = filterKategori.value || "";

      var filtered = allProducts.filter(function(p){
        var matchName = (p.nama || "").toLowerCase().indexOf(q) !== -1;
        var matchCat = !cat || (p.kategori === cat);
        return matchName && matchCat;
      });

      return filtered;
    }

    function renderProducts(reset){
      if(reset){ page = 1; }

      var data = filterData();
      if(!data.length){
        btnLoadMore.style.display = "none";
        showEmpty();
        return;
      }

      var start = 0;
      var end = page * perPage;
      var slice = data.slice(start, end);

      var html = '<div class="grid">';
      slice.forEach(function(p){
        var desc = p.deskripsi.length ?
          p.deskripsi[0] :
          "Detail paket akan dijelaskan admin saat pemesanan.";

        var msg =
          "Halo admin, saya ingin pesan " + p.nama +
          " dengan harga " + formatRp(p.hargaTampil) + ".";

        html +=
          '<div class="cardx">' +
            '<div class="cardx-top">' +
              '<div class="logo">' +
                '<img src="' + escapeHtml(p.ikon) + '" alt="' + escapeHtml(p.nama) + '"' +
                ' onerror="this.src=\'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSIxMiIgZmlsbD0iI2YxZjVmNSIgc3Ryb2tlPSIjZDUzY2ZmIi8+PHBhdGggZD0iTTEwIDIxaDEyIiBzdHJva2U9IiM0MTM4NTYiIHN0cm9rZS13aWR0aD0iMiIgLz48cGF0aCBkPSJNMTEgMTJoMTAiIHN0cm9rZT0iIzQxMzg1NiIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+\';">' +
              '</div>' +
              '<div>' +
                '<div class="title">' + escapeHtml(p.nama) + '</div>' +
                '<div class="category">' + escapeHtml(p.kategori || "Digital") + '</div>' +
              '</div>' +
            '</div>' +
            '<div class="desc">' + escapeHtml(desc) + '</div>' +
            '<div class="price-row">' +
              '<div>' +
                '<div class="price-main">' + formatRp(p.hargaTampil) + '</div>' +
                '<div class="price-base">Perkiraan harga dasar: ' + formatRp(p.hargaDasar) + '</div>' +
              '</div>' +
            '</div>' +
            '<button class="btn-wa" onclick="window.open(\'' + 
              makeWAUrl(msg, p.wa) + '\', \'_blank\');">' +
              '<i class="fa-brands fa-whatsapp"></i><span>Pesan via WhatsApp</span>' +
            '</button>' +
          '</div>';
      });
      html += '</div>';

      produkList.innerHTML = html;

      if(data.length > end){
        btnLoadMore.style.display = "inline-flex";
      }else{
        btnLoadMore.style.display = "none";
      }
    }

    async function loadProdukFromSheet(){
      showLoading();
      try{
        var res = await fetch(SHEET_JSON_URL, { cache: "no-store" });
        var text = await res.text();

        // potong prefix "google.visualization.Query.setResponse("
        var json = JSON.parse(text.substring(47, text.length - 2));
        var rows = json.table.rows || [];

        allProducts = [];

        for(var i=0; i<rows.length; i++){
          var r = rows[i];
          var c = r.c || [];

          var nama = (c[0] && c[0].v) || "";
          if(!nama){ continue; }

          var hargaNormal = Number((c[1] && c[1].v) || 0) || 0;
          var ikon = (c[2] && c[2].v) || "";
          var deskripsiRaw = (c[3] && c[3].v) ? String(c[3].v) : "";
          var deskripsi = deskripsiRaw.split("||").map(function(s){return s.trim();}).filter(Boolean);
          var kategori = (c[4] && c[4].v) || "";
          var grup = (c[9] && c[9].v) || "";
          var hargaResCell = (c[10] && c[10].v);

          var hargaRes = null;
          if(hargaResCell !== undefined && hargaResCell !== null && hargaResCell !== ""){
            hargaRes = Number(hargaResCell) || 0;
          }

          var base = (hargaRes !== null ? hargaRes : hargaNormal);
          var MARKUP = 9000;
          var hargaTampil = base + MARKUP;

          allProducts.push({
            nama: nama,
            kategori: kategori,
            ikon: ikon,
            deskripsi: deskripsi,
            grup: grup,
            hargaDasar: base,
            hargaTampil: hargaTampil,
            wa: DEFAULT_WA
          });
        }

        renderProducts(true);
      }catch(err){
        console.error(err);
        showError(err);
      }
    }

    // ==== POPUP WELCOME ====
    function initWelcomePopup(){
      var popup = document.getElementById("welcomePopup");
      var btn = document.getElementById("welcomeGotIt");
      if(!popup || !btn){ return; }

      var seen = sessionStorage.getItem("dnd_welcome_seen");
      if(!seen){
        popup.classList.add("show");
      }

      btn.addEventListener("click", function(){
        popup.classList.remove("show");
        sessionStorage.setItem("dnd_welcome_seen", "1");
      });
    }

    document.addEventListener("DOMContentLoaded", function(){
      var y = document.getElementById("yearNow");
      if(y){ y.textContent = new Date().getFullYear(); }

      loadProdukFromSheet();
      initWelcomePopup();

      if(searchInput){
        searchInput.addEventListener("input", function(){
          renderProducts(true);
        });
      }
      if(filterKategori){
        filterKategori.addEventListener("change", function(){
          renderProducts(true);
        });
      }
      if(btnLoadMore){
        btnLoadMore.addEventListener("click", function(){
          page += 1;
          renderProducts(false);
        });
      }
    });
  </script>
</body>
</html>
